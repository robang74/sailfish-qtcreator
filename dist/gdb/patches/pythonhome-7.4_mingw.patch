commit ce5f5fae548fe2e34c96b5df8e054d539df00b0c (HEAD -> master)
Author: Martin Kampas <martin.kampas@seafarix.com>
Date:   Wed Aug 14 12:28:10 2024 +0200

    Find the bundled python

diff --git a/gdb/python/python.c b/gdb/python/python.c
index b00b70b..2ac4cb4 100644
--- a/gdb/python/python.c
+++ b/gdb/python/python.c
@@ -33,6 +33,8 @@
 #include "python.h"
 #include "extension-priv.h"
 #include "cli/cli-utils.h"
+#include <libloaderapi.h>
+#include <libgen.h>
 #include <ctype.h>
 #include "location.h"
 #include "ser-event.h"
@@ -1748,6 +1750,16 @@ message == an error message without a stack will be printed."),
 #endif
 #endif
 
+
+  char modulefnbuffer[BUFSIZ];
+  int modulefnlen = GetModuleFileName(NULL, modulefnbuffer, BUFSIZ - 1);
+  modulefnbuffer[modulefnlen] = 0;
+  char *executeablepath = dirname(modulefnbuffer);
+  char *pythonhome = (char*)malloc(strlen(executeablepath) + strlen("\\python\\") + 2);
+  strcpy(pythonhome, executeablepath);
+  strcat(pythonhome, "\\python\\");
+  _putenv_s("PYTHONHOME", pythonhome);
+
   Py_Initialize ();
   PyEval_InitThreads ();
 
